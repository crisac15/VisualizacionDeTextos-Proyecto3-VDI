---
title: "An√°lisis de emociones en 'Conversaci√≥n con una momia'"
author: "Cristopher Acu√±a - Jerson Prendas"
date: "`30/06/2025"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Librer√≠as necesarias
install.packages("stopwords")
library(stopwords)
library(tidyverse)
library(ggwordcloud)
library(syuzhet)
library(tm)
library(SnowballC)
library(igraph)
library(ggraph)
library(tokenizers)
library(tidytext)
library(ggplot2)
```

## üìö Introducci√≥n

Este an√°lisis se basa en la metodolog√≠a propuesta por D√©bora Rodrigo-Ruiz (2022), utilizando an√°lisis digital de emociones en textos literarios. Se aplica el an√°lisis al cuento "Conversaci√≥n con una momia" de Edgar Allan Poe, con el fin de explorar el vocabulario emocional, la polaridad narrativa y los recursos afectivos que intervienen en la construcci√≥n del texto.

## üì• Carga y limpieza del texto

```{r}
# Versi√≥n 1: texto limpio para wordcloud y red (SIN puntuaci√≥n)
texto <- readLines("Conversacion con una momia.txt", encoding = "UTF-8")
texto <- tolower(paste(texto, collapse = " "))
texto <- gsub("[[:punct:]]", "", texto)
texto <- gsub("[0-9]", "", texto)

# Versi√≥n 2: texto crudo para an√°lisis narrativo (CON puntuaci√≥n)
texto_narrativo <- readLines("Conversacion con una momia.txt", encoding = "UTF-8")
texto_narrativo <- paste(texto_narrativo, collapse = " ")
```

## ‚òÅÔ∏è Nube de palabras emocionales

```{r}
ggplot(datos %>% slice_max(frecuencia, n = 120), aes(
  label = palabra,
  size = frecuencia,
  color = frecuencia
)) +
  geom_text_wordcloud_area(shape = "circle", rm_outside = TRUE) +
  scale_size_area(max_size = 16) +
  scale_color_gradient(low = "#1a9641", high = "#d7191c") +
  theme_minimal() +
  labs(title = "Nube de palabras emocionales (top 120)")

```

## ‚öñÔ∏è An√°lisis de polaridad emocional

```{r}

# 1. Dividir en oraciones
oraciones <- get_sentences(texto_narrativo)

# 2. Obtener emociones NRC en espa√±ol por oraci√≥n
emociones <- get_nrc_sentiment(oraciones, lang = "spanish")

# 3. Calcular polaridad: positivo - negativo
polaridad <- emociones$positive - emociones$negative

# 4. Verificar que haya variaci√≥n emocional
if (length(polaridad) > 2 && any(is.finite(polaridad)) && sd(polaridad) > 0) {
  # Aplicar suavizado con DCT
  arco <- get_dct_transform(polaridad,
                            low_pass_size = min(length(polaridad), 20),
                            scale_range = TRUE)

  # 5. Graficar arco emocional
  plot(arco, type = "l", col = "darkgreen", lwd = 2,
       main = "Arco emocional de 'Conversaci√≥n con una momia'",
       xlab = "Progresi√≥n narrativa", ylab = "Polaridad emocional")
  abline(h = 0, lty = 2, col = "gray")
} else {
  message("No se detect√≥ suficiente polaridad en el texto completo.")
}
```

## üìä Conteo de emociones (NRC)

```{r}
nrc <- get_nrc_sentiment(get_sentences(texto))
emociones_sum <- colSums(nrc[, 1:8])
barplot(emociones_sum, las = 2, col = rainbow(8), main = "Conteo de emociones NRC")
```

## üï∏Ô∏è Red de palabras (coocurrencia)

```{r}
# Tokenizar en oraciones
oraciones <- unlist(tokenize_sentences(texto))

# Crear corpus y procesar
corpus <- VCorpus(VectorSource(oraciones))
corpus <- tm_map(corpus, content_transformer(tolower))
corpus <- tm_map(corpus, removePunctuation)
corpus <- tm_map(corpus, removeNumbers)
corpus <- tm_map(corpus, removeWords, stopwords("es"))
corpus <- tm_map(corpus, stripWhitespace)
corpus <- tm_map(corpus, stemDocument, language = "spanish")

# Matriz t√©rmino-documento
tdm <- TermDocumentMatrix(corpus)
mat <- as.matrix(tdm)

# Seleccionar top 40 palabras m√°s frecuentes
frecuencias <- rowSums(mat)
top_terms <- names(sort(frecuencias, decreasing = TRUE))[1:40]
mat <- mat[top_terms, ]
mat[mat >= 1] <- 1  # binarizar

# Matriz de co-ocurrencia
cooc <- mat %*% t(mat)
diag(cooc) <- 0
cooc[cooc < 2] <- 0  # filtrar conexiones d√©biles

# Crear grafo
g <- graph.adjacency(cooc, weighted = TRUE, mode = "undirected")
g <- simplify(g)
g <- delete_vertices(g, degree(g) == 0)

# Visualizaci√≥n
set.seed(123)
layout <- layout_with_fr(g)

plot(
  g,
  layout = layout,
  vertex.size = 8,
  vertex.label.cex = 0.8,
  vertex.label.color = "black",
  vertex.color = "#AED6F1",
  edge.width = E(g)$weight,
  edge.color = "gray60",
  main = "Red de palabras m√°s frecuentes"
)

```

## üìù Conclusi√≥n

Este an√°lisis permite observar c√≥mo la narrativa de Poe utiliza vocabulario emocional para generar tensi√≥n, iron√≠a y sorpresa. El arco emocional, el conteo NRC y la red sem√°ntica revelan la estructura interna del relato. El enfoque digital empleado se basa en m√©todos similares a los usados por Rodrigo-Ruiz (2022) en la narrativa cervantina.
